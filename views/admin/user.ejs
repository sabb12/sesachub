<!DOCTYPE html>
<html lang="ko">
<%- include('../include/include.ejs',{title:"ê´€ë¦¬ìí˜ì´ì§€"}) %>
<link rel="stylesheet" href="/static/css/admin/user.css">
<style>
    .search-bar {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.search-bar select,
.search-bar input[type="text"],
.search-bar button {
    margin-right: 10px;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.search-bar select {
    flex: 1;
    max-width: 150px; /* ì›í•˜ëŠ” ë„ˆë¹„ë¡œ ì¡°ì • */
}

.search-bar input[type="text"] {
    flex: 2;
    max-width: 300px; /* ì›í•˜ëŠ” ë„ˆë¹„ë¡œ ì¡°ì • */
}

.search-bar button {
    background-color: white;
    cursor: pointer;
    transition: background-color 0.3s;
}

.search-bar button:hover {
    background-color: #6fc274;
    color: white;
}
</style>
<body>
    <%- include('../include/header.ejs') %>
    <div id="member-content" >
        <h2>íšŒì› ê´€ë¦¬ í˜ì´ì§€</h2>
        <div class="search-bar">
            <select name="category" id="category">
                <option value="u_id">ì•„ì´ë””</option>
                <option value="name">ì´ë¦„</option>
                <!-- ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë„ í•„ìš”ì— ë”°ë¼ ì¶”ê°€í•˜ì„¸ìš” -->
            </select>
            <input type="text" name="search" id="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <button onclick="search()">ê²€ìƒ‰</button>
        </div>
        <div class="pagination">
            <% if(permission){ %>
                <% for (i=1; i <=totalPages; i++) { %>
                    <a href="/admin/user?page=<%= i %>&category=<%= category %>&search=<%= search%>">
                        <%= i %>
                    </a>
                <% } %>
                <% }else{ %>
                    <% for (i=1; i <=totalPages; i++) { %>
                        <a href="/admin/user?page=<%= i %>&category=<%=category %>&&search=<%= search%>&permission=null">
                            <%= i %>
                        </a>
                    <% } %>
                <% } %>
            
        </div>
        
        
        <button class="permissionBtn" onclick="gi(this.value)" value="permission"><a href="/admin/user?permission=null">ê¶Œí•œëŒ€ê¸° ìœ ì €</a></button>
        <button class="permissionBtn"><a href="/admin/user">íšŒì›ì „ì²´ ì¡°íšŒ</a></button>
        <table id="member-table">
            <tr>
                <th>ì•„ì´ë””</th>
                <th>ì´ë¦„</th>
                <th>ë‹‰ë„¤ì„</th>
                <th>ì´ë©”ì¼</th>
                <th>ê°€ì…ì¼</th>
                <th>ìˆ˜ì •ì¼</th>
                <th>ê¶Œí•œ</th>
                <th>í´ë˜ìŠ¤</th>
                <th>íœ´ëŒ€í° ë²ˆí˜¸</th>
                <th>pwì´ˆê¸°í™”</th>
            </tr>
            <% userList.forEach(user => { %>
                <tr>
                    <td><%= user.u_id %></td>
                    <td><%= user.name %></td>
                    <td><%= user.nk_name %></td>
                    <td><%= user.email %></td><!--ë°ì´íƒ€ë¥¼ substring(0,ì¡°ê±´)+ (ë°ì´í„°.length >ì¡°ê±´ ? ê°’1:ê°’2)-->
                    <td><%= user.createdAt.toLocaleString('ko-KR', { year: '2-digit', month: '2-digit', day: '2-digit', hour: '2-digit'}) %></td>
                    <td><%= user.updatedAt.toLocaleString('ko-KR', { year: '2-digit', month: '2-digit', day: '2-digit', hour: '2-digit'}) %></td>
                    <% if(user.permission===null) {%>
                        <td>ê¶Œí•œì—†ìŒ
                            <select id="permissionSelect">
                            <option value="admin">ê´€ë¦¬ì</option>
                            <option value="student">ìˆ˜ê°•ìƒ</option>
                            <option value="graduate_student">ìˆ˜ë£Œìƒ</option>
                            <option value="user">ê´€ê³„ì</option>
                            <!-- ë‹¤ë¥¸ ê¶Œí•œ ì˜µì…˜ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. -->
                        </select>
                        <button class="permissionBtn" onclick="permissionAdd('<%= user.u_id %>')">ê¶Œí•œë¶€ì—¬</button>
                    </td>
                        <% }else{ %>
                            <td><%= user.permission %></td>
                        <% } %>
                    <td><%= user.course %></td>
                    <td><%= user.phone %></td>
                    <td><button class="permissionBtn"><a onclick="pwReset('<%=user.u_id%>')">ì´ˆê¸°í™”</a></button></td>
                </tr>
            <% }); %>
            
        </table>
        <% if(userList.length === 0) { %>
            <div class="noData"><h1>ğŸ˜«ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</h1></div>
            <% }%>  

        
    </div>
    <script>
        (()=> {
        let totalPages = '<%= page %>'-1 // totalPages ê°’ì€ ì„œë²„ì—ì„œ ë Œë”ë§í•  ë•Œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
        let paginationDiv = document.querySelector('.pagination');
        let btns = document.querySelectorAll('.pagination a');

        for (let i = 0; i < btns.length; i++) {
        if (i === totalPages) {
            btns[i].classList.add('active');
        } else {
            btns[i].classList.remove('active');
        }
        }
        })();
        function search() {
            let category = document.getElementById("category").value;
            let searchValue = document.getElementById("search").value;
                console.log(category,searchValue)
                let permission='<%=permission%>'
                if(permission==='true'){
                    location.href=`/admin/user?category=${category}&search=${searchValue}`
                }else{
                    location.href=`/admin/user?category=${category}&search=${searchValue}&permission=null`

                }
        
        }
    </script>
    <script src="/static/js/admin/user.js"></script>
    
</body>
</html>